<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ThinkTalk Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
/* Reset & Styles Windows Phone */
:root {
    --accent: #00a2e8; /* Bleu Lumia */
    --bg: #000;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body, html {
    margin: 0; padding: 0;
    background: var(--bg);
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
    overflow: hidden; /* Empêche le scroll du navigateur */
    height: 100%;
}

/* Conteneur Panorama : Coulissement horizontal entre les pages */
#panorama {
    display: flex;
    width: 300vw; /* 3 pages : Accueil, Chat, Contacts */
    height: 100vh;
    transition: transform 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
}

.view {
    width: 100vw;
    height: 100vh;
    padding: 20px;
    display: flex;
    flex-direction: column;
    position: relative;
}

/* Titres démesurés typiques Metro UI */
.page-title {
    font-size: 14px;
    text-transform: uppercase;
    font-weight: 600;
    margin-top: 10px;
    letter-spacing: 2px;
}

.section-header {
    font-size: 60px;
    font-weight: 100;
    margin-left: -5px;
    margin-bottom: 30px;
    color: #fff;
    white-space: nowrap;
}

/* Tuiles Windows Phone */
.tiles-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.tile {
    background: var(--accent);
    aspect-ratio: 1/1;
    padding: 12px;
    display: flex;
    align-items: flex-end;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
}

.tile:active { transform: scale(0.95); background: #333; }

/* Liste de messages mobile */
#message-container {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 80px;
    padding-right: 5px;
}

.msg-bubble {
    margin-bottom: 20px;
    border-left: 3px solid var(--accent);
    padding-left: 15px;
}

.msg-pseudo { color: var(--accent); font-size: 14px; font-weight: bold; margin-bottom: 4px; }
.msg-text { font-size: 22px; line-height: 1.2; font-weight: 300; }

/* Barre de saisie style Phone 8 */
.input-bar {
    position: absolute;
    bottom: 20px;
    left: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    background: #000;
}

input[type="text"], input[type="password"] {
    background: #fff;
    border: none;
    padding: 15px;
    font-size: 18px;
    flex: 1;
}

.send-btn {
    background: var(--accent);
    border: none;
    width: 55px;
    color: white;
    font-size: 24px;
}

/* Menu flottant du bas */
.nav-bottom {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 60px;
    background: #111;
    display: flex;
    justify-content: space-around;
    align-items: center;
    border-top: 1px solid #333;
    z-index: 100;
}

.nav-item {
    font-size: 12px;
    text-transform: uppercase;
    color: #888;
    text-align: center;
}

.nav-item.active { color: #fff; font-weight: bold; }

/* Auth Overlay Plein écran */
#auth {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 1000;
    padding: 40px 20px;
}

.hidden { display: none !important; }
</style>
</head>
<body>

<div id="auth">
    <div class="page-title">THINKTALK</div>
    <h1 class="section-header">bienvenue</h1>
    <div style="margin-top: 50px;">
        <input id="pseudo" type="text" placeholder="pseudo" style="margin-bottom:10px; width: 100%;">
        <input id="code" type="password" placeholder="code" style="margin-bottom:20px; width: 100%;">
        <button onclick="handleLogin()" style="width:100%; padding:15px; background:var(--accent); color:white; border:none; font-weight:bold;">SE CONNECTER</button>
        <p onclick="handleRegister()" style="text-align:center; color:#888; margin-top:20px;">créer un compte</p>
    </div>
</div>

<div id="panorama">
    
    <div class="view" id="view-hub">
        <div class="page-title">THINKTALK</div>
        <h1 class="section-header">accueil</h1>
        <div class="tiles-container">
            <div class="tile" onclick="openRoom('general')">#general</div>
            <div class="tile" onclick="openRoom('gaming')">#gaming</div>
            <div class="tile" style="background:#333" onclick="goTo(2)">contacts</div>
            <div class="tile" style="background:#e81123" onclick="logout()">quitter</div>
        </div>
    </div>

    <div class="view" id="view-chat">
        <div class="page-title">THINKTALK</div>
        <h1 class="section-header" id="chat-title">salon</h1>
        <div id="message-container"></div>
        <div class="input-bar">
            <input id="msgInput" type="text" placeholder="écrire...">
            <button class="send-btn" onclick="send()">➔</button>
        </div>
    </div>

    <div class="view" id="view-contacts">
        <div class="page-title">THINKTALK</div>
        <h1 class="section-header">contacts</h1>
        <div id="contacts-list"></div>
        <button onclick="addContact()" style="background:none; border:2px solid white; color:white; padding:10px; margin-top:20px; width: 100%;">+ AJOUTER</button>
    </div>

</div>

<div class="nav-bottom">
    <div class="nav-item" onclick="goTo(0)">accueil</div>
    <div class="nav-item" onclick="goTo(1)">chat</div>
    <div class="nav-item" onclick="goTo(2)">contacts</div>
</div>

<script>
// --- CONFIG FIREBASE ---
const firebaseConfig = {
  apiKey: "AIzaSyCrgPMXzSyS6NXNajPxr0x_J-CTESOtp5w",
  authDomain: "chat-github-6abb5.firebaseapp.com",
  databaseURL: "https://chat-github-6abb5-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "chat-github-6abb5",
  storageBucket: "chat-github-6abb5.firebasestorage.app",
  messagingSenderId: "1038562300660",
  appId: "1:1038562300660:web:b57b74a7539466e16384a1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let user = localStorage.getItem('tt_user');
let currentRoom = 'general';

// --- NAVIGATION ---
function goTo(index) {
    document.getElementById('panorama').style.transform = `translateX(-${index * 100}vw)`;
    const navs = document.querySelectorAll('.nav-item');
    navs.forEach((n, i) => n.classList.toggle('active', i === index));
}

// --- LOGIQUE AUTH ---
async function handleLogin() {
    const p = document.getElementById('pseudo').value;
    const c = document.getElementById('code').value;
    const snap = await db.ref('users/'+p).get();
    if(snap.exists() && snap.val().code === c) {
        loginSuccess(p);
    } else { alert("Erreur identifiants"); }
}

function loginSuccess(p) {
    user = p;
    localStorage.setItem('tt_user', p);
    document.getElementById('auth').classList.add('hidden');
    loadContacts();
    openRoom('general');
}

// --- LOGIQUE CHAT ---
function openRoom(name) {
    currentRoom = name;
    document.getElementById('chat-title').textContent = name;
    listenMessages();
    goTo(1);
}

function listenMessages() {
    const ref = db.ref('messages/public/' + currentRoom);
    const container = document.getElementById('message-container');
    ref.off();
    container.innerHTML = "";
    
    ref.limitToLast(20).on('child_added', snap => {
        const m = snap.val();
        const div = document.createElement('div');
        div.className = 'msg-bubble';
        div.innerHTML = `<div class="msg-pseudo">${m.pseudo}</div><div class="msg-text">${m.text}</div>`;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
    });
}

function send() {
    const txt = document.getElementById('msgInput').value;
    if(!txt) return;
    db.ref('messages/public/' + currentRoom).push({
        pseudo: user,
        text: txt,
        timestamp: Date.now()
    });
    document.getElementById('msgInput').value = "";
}

function logout() { localStorage.clear(); location.reload(); }

// Init
if(user) { loginSuccess(user); }
</script>
</body>
</html>
