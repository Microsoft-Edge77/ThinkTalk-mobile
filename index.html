<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ThinkTalk | Particle Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --accent: #0078d7; --bg: #000; --text: #fff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Segoe UI", sans-serif; }
        body { background: var(--bg); color: var(--text); overflow: hidden; height: 100svh; position: fixed; width: 100%; }
        
        #canvas-dust { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

        /* 1) Glissement + Flou */
        .app-root { 
            position: relative; z-index: 1; height: 100%; display: none; flex-direction: column; 
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), filter 0.6s;
        }
        .view-blur { filter: blur(20px); transform: translateX(-50px); }

        /* 2) Expansion des Tuiles */
        .tiles-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; transition: all 0.5s; }
        .tile { 
            position: relative; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); 
            padding: 15px; height: 110px; display: flex; flex-direction: column; justify-content: flex-end; 
            cursor: pointer; backdrop-filter: blur(10px);
            transition: transform 0.4s ease, opacity 0.4s;
        }
        .tile.expanding { position: fixed; inset: 0; z-index: 100; height: 100vh; width: 100vw; transform: scale(1.2); opacity: 0; pointer-events: none; }
        .tile.pushed { transform: scale(0.8); opacity: 0; }

        /* 3) Matérialisation des messages */
        .msg-block { opacity: 0; transform: translateY(10px); transition: opacity 0.5s 0.8s, transform 0.5s 0.8s; }
        .msg-block.visible { opacity: 1; transform: translateY(0); }
        .msg-text { background: rgba(0,120,215,0.1); padding: 12px; border: 1px solid rgba(0,120,215,0.3); }

        /* Popups */
        .popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(0px); transition: backdrop-filter 0.5s; }
        .popup-card { background: #000; border: 2px solid var(--accent); width: 100%; max-width: 320px; padding: 25px; opacity: 0; transition: opacity 0.5s 0.8s; }
        
        /* Rest of Interface */
        .auth-logo { font-size: 3.5rem; font-weight: 100; color: var(--accent); margin-bottom: 40px; }
        .top-bar { padding: 15px; display: flex; justify-content: space-between; align-items: center; height: 70px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 60px; display: flex; background: #000; border-top: 1px solid #222; }
        .nav-btn { flex: 1; display: flex; align-items: center; justify-content: center; color: #666; cursor: pointer; font-size: 0.8rem; }
        .nav-btn.active { color: #fff; border-top: 3px solid var(--accent); }
    </style>
</head>
<body>

<canvas id="canvas-dust"></canvas>

<div id="auth-screen">
    <div class="auth-logo">thinktalk</div>
    <div style="width:300px">
        <input type="text" id="auth-pseudo" style="width:100%;padding:12px;margin-bottom:10px;background:#111;border:1px solid #333;color:#fff" placeholder="Pseudo">
        <button id="btn-login" style="width:100%;padding:15px;background:var(--accent);border:none;color:#fff;font-weight:bold">ENTRER</button>
    </div>
</div>

<div class="app-root" id="main-app">
    <div class="top-bar"><div style="font-size:2rem;color:var(--accent)">thinktalk</div></div>
    <div class="view-container" style="padding:10px">
        <section id="view-home" class="view-section active">
            <div class="tiles-grid" id="rooms-grid">
                </div>
        </section>
        <section id="view-chat" class="view-section">
            <div id="chat-messages"></div>
            <div style="height:80px"></div>
        </section>
    </div>
    <nav class="bottom-nav">
        <div class="nav-btn active" onclick="switchTab('home')">HOME</div>
        <div class="nav-btn" onclick="switchTab('chat')">CHAT</div>
    </nav>
</div>

<script type="module">
    // --- MOTEUR DE PARTICULES AVANCÉ ---
    const canvas = document.getElementById('canvas-dust'), ctx = canvas.getContext('2d');
    let pts = [], mouse = {x: -100, y: -100};
    const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    window.onresize = resize; resize();

    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

    class Particle {
        constructor() {
            this.init();
            this.target = null; // Position cible pour matérialisation
        }
        init() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.baseX = this.x; this.baseY = this.y;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.s = Math.random() * 2 + 1;
        }
        update() {
            if (this.target) {
                // Attraction vers la cible (Matérialisation)
                this.x += (this.target.x - this.x) * 0.12;
                this.y += (this.target.y - this.y) * 0.12;
            } else {
                // Vol libre + impulsion souris
                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 100) {
                    this.vx += dx * 0.01; // Impulsion vers la souris
                    this.vy += dy * 0.01;
                }
                this.x += this.vx; this.y += this.vy;
                this.vx *= 0.98; this.vy *= 0.98; // Friction

                if(this.x<0||this.x>canvas.width) this.vx *= -1;
                if(this.y<0||this.y>canvas.height) this.vy *= -1;
            }
        }
        draw() {
            ctx.fillStyle = "#0078d7";
            ctx.beginPath(); ctx.arc(this.x, this.y, this.s, 0, Math.PI*2); ctx.fill();
        }
    }

    for(let i=0; i<600; i++) pts.push(new Particle());

    function animateParticles() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        pts.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animateParticles);
    } animateParticles();

    // --- LOGIQUE ANIMATION UI ---

    // 1) Matérialisation
    window.materialize = (element) => {
        const rect = element.getBoundingClientRect();
        const pointsPerEdge = 40;
        let targets = [];

        // Créer un rectangle de points cibles
        for(let i=0; i<pointsPerEdge; i++) {
            targets.push({x: rect.left + (rect.width/pointsPerEdge)*i, y: rect.top}); // Top
            targets.push({x: rect.left + (rect.width/pointsPerEdge)*i, y: rect.bottom}); // Bottom
            targets.push({x: rect.left, y: rect.top + (rect.height/pointsPerEdge)*i}); // Left
            targets.push({x: rect.right, y: rect.top + (rect.height/pointsPerEdge)*i}); // Right
        }

        // Assigner les cibles aux particules
        pts.forEach((p, index) => {
            if (targets[index]) p.target = targets[index];
        });

        // Après 800ms, les particules repartent et le bloc devient solide
        setTimeout(() => {
            pts.forEach(p => p.target = null);
            element.classList.add('visible');
        }, 800);
    };

    // 2) Navigation Floue + Glissement
    window.switchTab = (tab) => {
        const app = document.getElementById('main-app');
        app.classList.add('view-blur');
        
        setTimeout(() => {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + tab).classList.add('active');
            app.classList.remove('view-blur');
        }, 300);
    };

    // 3) Expansion Tuiles
    window.expandTile = (el, roomName) => {
        const tiles = document.querySelectorAll('.tile');
        tiles.forEach(t => {
            if (t !== el) t.classList.add('pushed');
        });
        el.classList.add('expanding');
        
        setTimeout(() => {
            switchTab('chat');
            // Reset tiles après transition
            setTimeout(() => {
                el.classList.remove('expanding');
                tiles.forEach(t => t.classList.remove('pushed'));
            }, 600);
        }, 400);
    };

    // Simulation Auth
    document.getElementById('btn-login').onclick = () => {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        renderFakeRooms();
    };

    function renderFakeRooms() {
        const grid = document.getElementById('rooms-grid');
        ["Général", "Design", "Dev", "Jeux"].forEach(name => {
            const t = document.createElement('div');
            t.className = 'tile';
            t.innerHTML = `<span># ${name}</span>`;
            t.onclick = () => expandTile(t, name);
            grid.appendChild(t);
        });
    }

    // Exemple de message qui se matérialise
    window.addMessage = (text) => {
        const container = document.getElementById('chat-messages');
        const m = document.createElement('div');
        m.className = 'msg-block';
        m.innerHTML = `<div class="msg-text">${text}</div>`;
        container.appendChild(m);
        materialize(m);
    };
    
    // Test : ajouter un message auto après 2s
    setTimeout(() => { if(document.getElementById('main-app').style.display !== 'none') addMessage("Bienvenue sur ThinkTalk !"); }, 3000);

</script>
</body>
</html>
